{{/* idea from https://alexlakatos.com/web/2020/07/17/hugo-image-processing/ and https://laurakalbag.com/processing-responsive-images-with-hugo/, converted into partial (and shortcode) */}}
{{/* call partial with (dict 'page' . 'img' _local_path_ 'alt' "text" ) */}}
{{- $args := .}}
{{- with ($args.src) -}}
<div>
  <img class="img-fluid" alt="{{with $args.alt}}{{.}}{{end}}"
  {{- with ($args.page.Resources.GetMatch $args.src) -}}
    {{- $src := . -}}
    {{- /* set image width sizes [500, 800 1200], hardcoded for now */ -}}
    {{- $tiny := ($src.Resize "500x") -}}
    {{- $small := ($src.Resize "800x") -}}
    {{- $medium := ($src.Resize "1200x") -}}
    {{- /* only use images smaller than or equal to the src (original) image size */ -}}
    {{- /* bugbug image is always resized, but might not be referenced in srcset */ -}}
    sizes="(min-width: 35em) 720px, 100vw"
    srcset='
    {{- if ge $src.Width "500" -}}
        {{- with $tiny.RelPermalink -}}{{.}} 500w{{- end -}}
    {{- end -}}
    {{- if ge $src.Width "800" -}}
        {{- with $small.RelPermalink -}}, {{.}} 800w{{- end -}}
    {{- end -}}
    {{- if ge $src.Width "1200" -}}
        {{- with $medium.RelPermalink -}}, {{.}} 1200w{{- end -}}
    {{- end -}}'
    {{- if $medium -}} src="{{- $medium.RelPermalink -}}"{{- else -}} src="{{- $src.RelPermalink -}}"{{- end -}}
  {{- else -}}
    {{- /* src isn't a resource, hope it's some other kind of url */ -}}
    src="{{- $args.src -}}"
  {{- end -}}
  > 
</div>
{{- end -}}

