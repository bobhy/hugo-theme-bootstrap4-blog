{{ define "title" }}{{ .Title | markdownify }} | {{ .Site.Title }}{{ end }}
{{ define "header" }}
{{ if (ne .Site.Params.header_visible false) }}
<header class="blog-header">
    <div class="container">
        <h1 class="blog-title" dir="auto"><a href="{{.CurrentSection.Permalink}}">{{ .CurrentSection.Page.Title | safeHTML}}</a></h1>
        {{ with .CurrentSection.Page.Params.description }}<p class="lead blog-description" dir="auto">{{ . | markdownify}}</p>{{ end }}
    </div>
</header>
{{ end }}
{{ end }}

{{ define "schema-dot-org" }}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  {{- /* Google recommends the headline be no more than 110 characters */}}
  "headline": {{ substr .Title 0 110 }},
  {{- $p := . -}}
  {{- with .Params.image -}}
  "image": {
    "@type": "ImageObject",
  {{- with $p.Resources.GetMatch (printf "*%s%" .) -}}
    "url": {{.Permalink}},
    {{- /* printf "--dbg resource name %#v permalink %#v" .Name .Permalink */ -}}
    "height": "{{ .Height }}",
    "width": "{{ .Width }}"
  {{- else -}}
    {{- /* if image is not local, best we can do is hope the URL is OK as is */ -}}
    "url": {{ . | absURL }}
  {{- end -}}
  }, 
  {{ end }}
  "url": {{ printf "%s" .Permalink }},
  "wordCount": "{{ .WordCount }}",
  {{- $ISO8601 := "2006-01-02T15:04:05-07:00" }}
  {{- if not .PublishDate.IsZero }}
  "datePublished": {{ .PublishDate.Format $ISO8601 }},
  {{- else }}
  "datePublished": {{ .Date.Format $ISO8601 }},
  {{- end }}
  {{- if not .Lastmod.IsZero }}
  "dateModified": {{ .Lastmod.Format $ISO8601 }},
  {{- end }}
  "author": {
    "@type": "Person",
    "name": {{ .Params.author | default .Site.Params.author }}
  }
  {{- if or (.Params.keywords) (or (.Params.categories) (.Params.tags)) -}}
  ,
  "keywords": {{ delimit (union .Params.keywords (union .Params.categories .Params.tags)) ", " }}
  {{- end }}

  {{- with .Params.description -}}
  ,
  "description": {{ . }}
  {{- end }}
}
</script>

{{ end }}

{{ define "main" }}
{{ $dateFormat := default "Mon Jan 2, 2006" (index .Site.Params "date_format") }}

<article class="blog-post">
  <header>
    <h2 class="blog-post-title" dir="auto"><a href="{{ .Permalink }}">{{ .Title | markdownify }}</a></h2>
    <p class="blog-post-meta">
{{ if not .PublishDate.IsZero }}<time {{ .Date.Format "2006-01-02T15:04:05Z07:00" | printf "datetime=%q" | safeHTMLAttr }}>{{ .Date.Format $dateFormat }}</time>{{ end }}
{{ if or (.Params.categories) (.Params.tags) }} {{ i18n "postedIn" }} {{ partial "meta-terms.html" . }}{{ end }}</p>
<p>{{partial "debug" (slice "single, overridable --" (.Param "foo_variable"))}}</p>
  </header>
  {{ partial "local-image.html"  (dict "page" . "src" (.Params.image) "alt" (print "Feature image for " .Name)) }}
  {{ .Content }}

  {{ if .IsTranslated }}
  <h4>{{ i18n "translations" }}</h4>
  <ul>
    {{ range .Translations }}
    <li>
      <a href="{{ .Permalink }}">{{ .Lang }}: {{ .Title }}{{ if .IsPage }}{{ end }}</a>
    </li>
    {{ end }}
  </ul>
  {{ end }}

  {{ if or (ne ($.Param "sharingicons") false) (.Site.DisqusShortname) }}
  <hr>
  <footer>

  {{ if (ne ($.Param "sharingicons") false) }}
  {{ partial "sharing-icons.html" . }}
  {{ end }}

  {{ if and (.Site.DisqusShortname) (ne .Params.comments false) }}
  {{ template "_internal/disqus.html" . }}
  {{ end }}
  </footer>
  {{ end }}

</article> <!-- /.blog-post -->

{{ end }}

{{ define "sidebar" }}
{{ partial "section-sidebar.html" . }}
{{ end }}

{{- /* vim: set ts=2 sw=2 et: */}}
